<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Orches Adam"><meta name="copyright" content="Orches Adam"><title>Orches's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Orches Adam</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">5</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Orches's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">Orches's Blog</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/14/DoNet-Interview/">DotNet 工程师 面试问题</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-14</time><div class="content"><p>此文档 fork 自<a href="https://github.com/guolaopi/DoNet-Interview" target="_blank" rel="noopener">guolaopi/DoNet-Interview</a></p></div><a class="more" href="/2019/07/14/DoNet-Interview/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/07/14/Miscellaneous/">杂项收集</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-07-14</time><div class="content"><h4 id="Sql-Server-Analyze"><a href="#Sql-Server-Analyze" class="headerlink" title="Sql Server Analyze"></a>Sql Server Analyze</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set statistics profile on</span><br><span class="line">set statistics io on</span><br><span class="line">set statistics time on</span><br><span class="line">go</span><br><span class="line">&lt;input any code you want&gt;</span><br><span class="line">go</span><br><span class="line">set statistics profile off</span><br><span class="line">set statistics io off</span><br><span class="line">set statistics time off</span><br></pre></td></tr></table></figure>
<hr></div><a class="more" href="/2019/07/14/Miscellaneous/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/09/15/Use_Core_Frst_When_Aleardy_Had_Database/">EntityFramework core ,当数据库存在时，使用Code First</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-15</time><div class="content"><a id="more"></a>
<h4 id="EntityFramework-core，当数据库存在时，使用code-first"><a href="#EntityFramework-core，当数据库存在时，使用code-first" class="headerlink" title="EntityFramework core，当数据库存在时，使用code first"></a>EntityFramework core，当数据库存在时，使用code first</h4><blockquote>
<p>必要条件</p>
</blockquote>
<p> 通过Nuget安装<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Microsoft.EntityFramework.Core</span><br><span class="line">Microsoft.EntityFramework.Tools</span><br><span class="line">Microsoft.EntityFramework.Design</span><br></pre></td></tr></table></figure></p>
<p> 然后通过命令行<br> 执行<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet ef dbcontext Scaffold [ConnectionString] Microsoft.EntityFrameworkCore.SqlServer -o [Output Folder] -f</span><br></pre></td></tr></table></figure></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet ef dbcontext Scaffold &quot;Data Source=PV-1;Initial Catalog=e18060401;User ID=sa;Password=123456&quot; Microsoft.EntityFrameworkCore.SqlServer -o EntityFramework -f</span><br></pre></td></tr></table></figure>
<p> 手动替换链接字符串[ConnectionString]和输出文件夹[Output Folder]</p>
<p> -f 强制执行，当文件夹中存在对应的类的时候，执行会覆盖原文件</p>
<p> 详情见<a href="https://www.learnentityframeworkcore.com/walkthroughs/existing-database" target="_blank" rel="noopener">Generating a model from an existing database</a></p>
<h4 id="更简单的办法"><a href="#更简单的办法" class="headerlink" title="更简单的办法"></a>更简单的办法</h4><p> 当然是安装<a href="https://marketplace.visualstudio.com/items?itemName=ErikEJ.EFCorePowerTools" target="_blank" rel="noopener">EF Core Power Tools</a>啦</p>
<hr>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/02/EF_Attach_Vs_Entry_State/">Entity Framework 中 DbSet.Attach(entity) 跟 DbContext.Entry(entity).State = EntityState.Modified 的区别</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-02</time><div class="content"><a id="more"></a>
<h4 id="DbSet-Attach-entity-vs-DbContext-Entry-entity-State-EntityState-Modified"><a href="#DbSet-Attach-entity-vs-DbContext-Entry-entity-State-EntityState-Modified" class="headerlink" title="DbSet.Attach(entity) vs DbContext.Entry(entity).State = EntityState.Modified"></a>DbSet.Attach(entity) vs DbContext.Entry(entity).State = EntityState.Modified</h4><p>&emsp;&emsp;When you do context.Entry(entity).State = EntityState.Modified;, you are not only attaching the entity to the DbContext, you are also marking the whole entity as dirty. This means that when you do context.SaveChanges(), EF will generate an update statement that will update all the fields of the entity.</p>

<p>&emsp;&emsp;This is not always desired.</p>

<p>&emsp;&emsp;On the other hand, DbSet.Attach(entity) attaches the entity to the context without marking it dirty. It is equivalent to doing context.Entry(entity).State = EntityState.Unchanged;</p>

<p>&emsp;&emsp;When attaching this way, unless you then proceed to update a property on the entity, the next time you call context.SaveChanges(), EF will not generate a database update for this entity.</p>

<p></p><p>&emsp;&emsp;Even if you are planning on making an update to an entity, if the entity has a lot of properties (db columns) but you only want to update a few, you may find it advantageous to do a DbSet.Attach(entity), and then only update the few properties that need updating. Doing it this way will generate a more efficient update statement from EF. EF will only update the properties you modified (in contrast to context.Entry(entity).State = EntityState.Modified; which will cause all properties/columns to be updated)</p>
<p>Relevant documentation: <a href="https://msdn.microsoft.com/en-us/data/jj592676" target="_blank" rel="noopener">Add/Attach and Entity States.</a></p>
<h5 id="Code-example"><a href="#Code-example" class="headerlink" title="Code example"></a>Code example</h5><p>Let’s say you have the following entity:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Person</span><br><span class="line">&#123;</span><br><span class="line">    public int Id &#123; get; set; &#125; // primary key</span><br><span class="line">    public string FirstName &#123; get; set; &#125;</span><br><span class="line">    public string LastName &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>If your code looks like this:</p>
<p>context.Entry(personEntity).State = EntityState.Modified;<br>context.SaveChanges();<br>The SQL generated will look something like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UPDATE person</span><br><span class="line">SET FirstName = &apos;whatever first name is&apos;,</span><br><span class="line">    LastName = &apos;whatever last name is&apos;</span><br><span class="line">WHERE Id = 123; -- whatever Id is.</span><br></pre></td></tr></table></figure>
<p>Notice how the above update statement will update all the columns, regardless or whether you’ve actually changed the values or not.</p>
<p>In contrast, if your code uses the “normal” Attach like this:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">context.People.Attach(personEntity); // State = Unchanged</span><br><span class="line">personEntity.FirstName = &quot;John&quot;; // State = Modified, and only the FirstName property is dirty.</span><br><span class="line">context.SaveChanges();</span><br></pre></td></tr></table></figure></p>
<p>Then the generated update statement is different:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE person</span><br><span class="line">SET FirstName = &apos;John&apos;</span><br><span class="line">WHERE Id = 123; -- whatever Id is.</span><br></pre></td></tr></table></figure></p>
<p>As you can see, the update statement only updates the values that were actually changed after you attached the entity to the context. Depending on the structure of your table, this can have a positive performance impact.</p>
<p>Now, which option is better for you depends entirely on what you are trying to do.</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/04/02/C-Basic/">C#_Basic</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-02</time><div class="content"><p>C# 语言的基础知识</p></div><a class="more" href="/2018/04/02/C-Basic/#more">阅读更多</a><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2019 By Orches Adam</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>